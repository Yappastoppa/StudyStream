What’s Actually Going On
	1.	Replit Preview Window (In-App):
	•	Web apps inside Replit’s “Preview” window (or some embedded browser contexts) can’t access geolocation APIs due to browser security restrictions.
	•	So, “Share location” either isn’t available or won’t work—nothing will ever ask for permission.
	2.	External Browser (e.g., Safari, Chrome):
	•	The map centers on your actual current location (possibly from a cached or background permission).
	•	BUT: You never get the explicit prompt to allow/deny location. This means the permission might be “prompt” or “granted” already, but the app never triggers the “request location” flow.
	•	The map keeps refreshing/jumping to your location: This means every GPS update is triggering a camera reset or re-render, causing a janky, “flickering” experience.
	•	No route polyline/line: Navigation UI appears, but the actual route (the colored line/path) doesn’t render, so you’re basically lost on a blank map.

⸻

How to Fix / What to Tell Your Dev

You want to send this as a clear dev prompt (feel free to copy/paste):

⸻

I’m testing the navigation on mobile, and here are the main issues:
	1.	Geolocation in Preview: In Replit’s in-app preview, geolocation never works (no location request is triggered). It only works if I open in an external browser.
	2.	No Permission Prompt in Browser: When I open in Safari/Chrome, I don’t get the usual “Allow location” prompt, but the app jumps to my location anyway. This might be using a cached permission, but it should always trigger a permission request and explain why.
	3.	Glitchy Map Re-centering: The map keeps refreshing/re-centering over and over at my current location, causing a glitchy/jumpy experience. Please make sure the camera smoothly follows the user, and only re-centers if the user has panned away (like Waze, Google Maps, etc.), not on every GPS update.
	4.	Route Polyline Missing: The route line (polyline) is missing when I start navigation—the turn-by-turn UI shows up, but I can’t see the actual route on the map.

What I need:
	•	Make sure the app always triggers a proper location permission prompt (with a user-friendly modal) when starting navigation, and explains if permission is denied.
	•	Only update the camera/zoom/center when necessary (use animation, don’t jump every GPS tick).
	•	Ensure the navigation route is always visible as a polyline/path overlay during navigation, and updates as I move.

This is for use on real phones, not just desktop preview.

Can you update and push a fix for these?

⸻

Developer Notes
	•	Use navigator.permissions to force checking and requesting geolocation on navigation start.
	•	Fix map animation: Use something like map.flyTo({ center: [lng, lat], essential: true, zoom }) but only when the route starts or user hits “Center” (not every update).
	•	Route polyline bug: Make sure route coordinates are passed to the map after directions are generated. Sometimes, these get dropped or reset when state updates.
