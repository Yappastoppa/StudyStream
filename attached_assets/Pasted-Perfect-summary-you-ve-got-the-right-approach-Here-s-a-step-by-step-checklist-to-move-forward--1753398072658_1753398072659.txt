Perfect summary—you’ve got the right approach. Here’s a step-by-step checklist to move forward:

⸻

1. If the Basic HTML Test Works:
	•	Your token is valid and NOT URL-restricted for local use.
	•	The problem is with how your React/Vite app is reading the environment variable (VITE_MAPBOX_TOKEN), not with Mapbox or the token itself.

How to Fix Vite Env Variable Issues:
	•	Make sure .env.local is in the project root, not in /client or another subfolder.
	•	The variable must be named exactly VITE_MAPBOX_TOKEN=pk.eyJ1... (no spaces before/after =).
	•	Restart Vite dev server (npm run dev or yarn dev) after adding or changing the .env.local.
	•	Access the token in React like:

mapboxgl.accessToken = import.meta.env.VITE_MAPBOX_TOKEN;


	•	Log it to check:

console.log("Loaded token:", import.meta.env.VITE_MAPBOX_TOKEN);



⸻

2. If the Basic HTML Test Fails:
	•	Console shows “Invalid token” or map is black:
	•	Check Mapbox Studio > Access Tokens for:
	•	URL Restrictions: Make sure your domain (e.g. https://*.replit.dev) is listed, or remove restrictions for debugging.
	•	Scopes: Make sure Styles:Read and Tiles:Read are enabled.
	•	Usage limits: Make sure your account isn’t over the free tier.
	•	Try running the HTML test on your local machine (file:///), or on a different network (not Replit) to rule out domain issues.

⸻

3. If React/Vite App Only Fails:
	•	It’s a frontend env config problem.
	•	Use console.log(import.meta.env) in your React component to see what Vite is injecting.
	•	If VITE_MAPBOX_TOKEN is undefined or empty:
	•	Double check .env.local is present and correct.
	•	If using Replit’s secrets UI, make sure it’s exposed as VITE_MAPBOX_TOKEN.
	•	Try process.env instead of import.meta.env only if you’re in Node, NOT in the browser.

⸻

4. If Network Tab Shows 401/403:
	•	Your token is being sent, but Mapbox is rejecting it.
	•	Check Mapbox Studio for:
	•	URL restrictions
	•	Token spelling/copy-paste errors
	•	If necessary, generate a fresh public token with no restrictions, just for testing.

⸻

TL;DR:
	•	If HTML test works, it’s your Vite/React config—focus on .env.local and import.meta.env.
	•	If HTML test fails, it’s your Mapbox token—check restrictions, scopes, or generate a new one.

Paste any error logs you see if you’re still stuck!
I can help debug line by line if you share your exact code and .env location/contents.